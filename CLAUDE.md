# CLAUDE.md - Real-Time Development Tracking

**æœ€åæ›´æ–°**: 2025-01-12
**é¡¹ç›®çŠ¶æ€**: ğŸš§ å¼€å‘ä¸­ (MVP Phase)
**å½“å‰ç‰ˆæœ¬**: 0.1.0-alpha

---

## ğŸ“Š é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**: AI Voice Chat PWA with Marketplace
**æŠ€æœ¯æ ˆ**: React 19 + TypeScript + Vite + Supabase + N8N
**éƒ¨ç½²å¹³å°**: Vercel (Frontend) + Vercel Serverless (Proxy)
**å¼€å‘å‘¨æœŸ**: MVP (2-3å‘¨) â†’ ä¸­æœŸ (1-2æœˆ) â†’ é•¿æœŸ (2-6æœˆ)

**å…³é”®æŒ‡æ ‡**:
- å¼€å‘è¿›åº¦: 25% (MVP Phase å·²å®ŒæˆåŸºç¡€è®¾ç½®)
- æµ‹è¯•è¦†ç›–: 0% (å¾…å®æ–½)
- ä»£ç è´¨é‡: N/A (å¾…è¯„ä¼°)
- æŠ€æœ¯å€ºåŠ¡: ä½

---

## ğŸ¯ å½“å‰çŠ¶æ€

### æ­£åœ¨è¿›è¡Œçš„å·¥ä½œ

**Phase 0: N8N é›†æˆ** âœ… **å·²å®Œæˆ**
- [x] N8N Cloud è¿æ¥é…ç½®
- [x] Self-Hosted N8N æ”¯æŒ
- [x] Vercel Serverless Proxy å®ç°
- [x] Settings UI æ”¹è¿›

**Phase 1: Supabase åˆå§‹åŒ–** ğŸš§ **å‡†å¤‡å¼€å§‹**
- [ ] åˆ›å»º Supabase é¡¹ç›®
- [ ] é…ç½®ç¯å¢ƒå˜é‡
- [ ] åˆ›å»ºæ•°æ®åº“è¡¨
- [ ] è®¾ç½® RLS ç­–ç•¥
- [ ] é…ç½® Storage Buckets

**ä¸‹ä¸€æ­¥**: å¼€å§‹ Phase 1.1 - æ‰‹åŠ¨åˆ›å»º Supabase é¡¹ç›®

---

## âœ… å·²å®ŒæˆåŠŸèƒ½

### Voice Chat æ ¸å¿ƒåŠŸèƒ½
- âœ… è¯­éŸ³è¯†åˆ« (Web Speech API)
- âœ… æ–‡å­—è½¬è¯­éŸ³ (TTS)
- âœ… AI å¯¹è¯ (æ”¯æŒ OpenAI, Anthropic, Mock)
- âœ… ä¼šè¯ç®¡ç† (Zustand + localStorage)
- âœ… PWA æ”¯æŒ

### N8N é›†æˆ
- âœ… N8N Cloud è¿æ¥
- âœ… Self-Hosted N8N æ”¯æŒ
- âœ… Workflow åˆ—è¡¨åŠ è½½
- âœ… Webhook è§¦å‘
- âœ… ä»£ç†æœåŠ¡å™¨ (è§£å†³ CORS)
- âœ… å®ä¾‹ç±»å‹åˆ‡æ¢

### UI/UX
- âœ… å“åº”å¼è®¾è®¡
- âœ… Dark Mode æ”¯æŒ
- âœ… Settings é¡µé¢
- âœ… Navigation ç»„ä»¶

---

## ğŸ“ å¼€å‘æ—¥å¿—

### 2025-01-12

**N8N Self-Hosted Support å®Œæˆ**
- æ·»åŠ äº†å®ä¾‹ç±»å‹é€‰æ‹©å™¨ (Cloud vs Self-Hosted)
- å®ç°äº†å¯é€‰çš„ Proxy è®¾ç½®
- æ›´æ–°äº† Settings UI å’Œè¯¦ç»†çš„è®¾ç½®æŒ‡å—
- æ‰€æœ‰åŠŸèƒ½æµ‹è¯•é€šè¿‡

**é—®é¢˜è§£å†³**:
- ä¿®å¤äº† Vercel éƒ¨ç½²çš„ ES Module é—®é¢˜
- ä¿®å¤äº† N8N API çš„æŸ¥è¯¢å‚æ•°é—®é¢˜
- ä¼˜åŒ–äº† Proxy æœåŠ¡å™¨çš„è·¯å¾„å¤„ç†

**ä¸‹ä¸€æ­¥è®¡åˆ’**:
- å¼€å§‹ Supabase é¡¹ç›®è®¾ç½®
- åˆ›å»ºæ•°æ®åº“æ¶æ„
- å®ç°ç”¨æˆ·è®¤è¯

---

### 2025-01-11

**N8N Cloud Connection å®Œæˆ**
- å®ç°äº† N8N Cloud è¿æ¥
- åˆ›å»ºäº† Vercel Serverless Proxy
- ä¿®å¤äº† CORS é—®é¢˜
- éƒ¨ç½²åˆ° Vercel æˆåŠŸ

**æŠ€æœ¯å†³ç­–**:
- ä½¿ç”¨ Vercel Serverless Functions ä½œä¸º Proxy
- è‡ªåŠ¨æ£€æµ‹ N8N Cloud åŸŸåå¹¶ä½¿ç”¨ä»£ç†
- ä¿æŒå‘åå…¼å®¹æ€§

---

## ğŸ—ï¸ æ¶æ„å†³ç­–è®°å½• (ADR)

### ADR-001: ä½¿ç”¨ Supabase ä½œä¸ºåç«¯
**æ—¥æœŸ**: 2025-01-12
**çŠ¶æ€**: âœ… å·²æ‰¹å‡†

**èƒŒæ™¯**:
- éœ€è¦æ•°æ®åº“ã€è®¤è¯ã€å­˜å‚¨åŠŸèƒ½
- å¸Œæœ›å¿«é€Ÿå¼€å‘ MVP

**å†³ç­–**:
- ä½¿ç”¨ Supabase ä½œä¸ºä¸»è¦åç«¯æœåŠ¡
- ä½¿ç”¨ Supabase MCP è¿›è¡Œæ‰€æœ‰æ•°æ®åº“æ“ä½œ
- ä½¿ç”¨ Supabase Auth è¿›è¡Œç”¨æˆ·è®¤è¯

**ç†ç”±**:
- å¼€ç®±å³ç”¨çš„åŠŸèƒ½ (Database, Auth, Storage)
- Row Level Security (RLS) æä¾›å®‰å…¨ä¿éšœ
- ä¸ Claude Code çš„ Supabase MCP å®Œç¾é›†æˆ
- å…è´¹é¢åº¦è¶³å¤Ÿ MVP ä½¿ç”¨

**å½±å“**:
- ç®€åŒ–åç«¯å¼€å‘
- æé«˜å¼€å‘é€Ÿåº¦
- æ½œåœ¨çš„ä¾›åº”å•†é”å®šé£é™©

---

### ADR-002: å‰ç«¯ä¼˜å…ˆå¼€å‘ç­–ç•¥
**æ—¥æœŸ**: 2025-01-12
**çŠ¶æ€**: âœ… å·²æ‰¹å‡†

**èƒŒæ™¯**:
- éœ€è¦å¿«é€ŸéªŒè¯ UI/UX
- å¸Œæœ›åœ¨è¿æ¥åç«¯å‰æµ‹è¯•åŠŸèƒ½

**å†³ç­–**:
- å…ˆç”¨ localStorage å®ç°æ‰€æœ‰åŠŸèƒ½
- æµ‹è¯• UI é€šè¿‡åå†è¿æ¥ Supabase
- æ¯ä¸ª Phase ç‹¬ç«‹æµ‹è¯•å’Œéƒ¨ç½²

**ç†ç”±**:
- å¿«é€ŸåŸå‹å¼€å‘
- ç‹¬ç«‹æµ‹è¯•å‰ç«¯é€»è¾‘
- é™ä½åç«¯æ›´æ”¹é£é™©
- æ›´å¥½çš„å…³æ³¨ç‚¹åˆ†ç¦»

**å½±å“**:
- éœ€è¦å†™ä¸¤æ¬¡ä»£ç  (mock + real)
- å¢åŠ åˆæœŸå¼€å‘æ—¶é—´
- ä½†é™ä½åæœŸè°ƒè¯•æ—¶é—´

---

### ADR-003: Vercel Serverless Proxy for N8N
**æ—¥æœŸ**: 2025-01-11
**çŠ¶æ€**: âœ… å·²æ‰¹å‡†

**èƒŒæ™¯**:
- N8N Cloud æœ‰ CORS é™åˆ¶
- æµè§ˆå™¨æ— æ³•ç›´æ¥è°ƒç”¨ N8N API

**å†³ç­–**:
- ä½¿ç”¨ Vercel Serverless Functions ä½œä¸ºä»£ç†
- è‡ªåŠ¨æ£€æµ‹ N8N Cloud å¹¶ä½¿ç”¨ä»£ç†
- Self-Hosted ç”¨æˆ·å¯é€‰æ‹©ä½¿ç”¨ä»£ç†

**ç†ç”±**:
- è§£å†³ CORS é—®é¢˜
- ä¿æŠ¤ API Key
- Vercel æä¾›å…è´¹é¢åº¦
- æ— éœ€é¢å¤–æœåŠ¡å™¨

**å½±å“**:
- å¢åŠ ä¸€å±‚ç½‘ç»œå»¶è¿Ÿ
- å— Vercel Serverless é™åˆ¶ (10s timeout)
- æœªæ¥å¯èƒ½éœ€è¦è¿ç§»åˆ°ä¸“ç”¨åç«¯

---

## ğŸ“¦ æ•°æ®åº“è¿ç§»å†å²

### Migration: å°šæœªåˆ›å»º
- ç­‰å¾… Phase 1 å¼€å§‹ååˆ›å»º

**è®¡åˆ’çš„è¿ç§»**:
1. `create_user_profiles_table` - ç”¨æˆ·èµ„æ–™è¡¨
2. `create_marketplace_apps_table` - å¸‚åœºåº”ç”¨è¡¨
3. `create_user_installed_apps_table` - å·²å®‰è£…åº”ç”¨è¡¨
4. `create_app_reviews_table` - åº”ç”¨è¯„ä»·è¡¨
5. `create_update_app_rating_function` - è¯„åˆ†æ›´æ–°è§¦å‘å™¨
6. `create_increment_downloads_function` - ä¸‹è½½ç»Ÿè®¡è§¦å‘å™¨

---

## ğŸ› å·²çŸ¥é—®é¢˜

### é«˜ä¼˜å…ˆçº§
- æ— 

### ä¸­ä¼˜å…ˆçº§
- N8N Workflow åˆ—è¡¨éœ€è¦åˆ†é¡µæ”¯æŒ (>50 workflows)
- éœ€è¦æ·»åŠ é”™è¯¯è¾¹ç•Œç»„ä»¶

### ä½ä¼˜å…ˆçº§
- Settings é¡µé¢å¯ä»¥ä¼˜åŒ–åŠ è½½æ€§èƒ½

---

## ğŸ“š æŠ€æœ¯æ–‡æ¡£

### ç¯å¢ƒå˜é‡

**å¿…éœ€çš„ç¯å¢ƒå˜é‡** (`.env.local`):
```bash
# Supabase (å¾…é…ç½®)
VITE_SUPABASE_URL=
VITE_SUPABASE_ANON_KEY=

# AI Providers (å¯é€‰)
VITE_OPENAI_API_KEY=
VITE_ANTHROPIC_API_KEY=

# N8N (ç”¨æˆ·è‡ªè¡Œé…ç½®)
# ä¸éœ€è¦ç¯å¢ƒå˜é‡,ç”¨æˆ·åœ¨ Settings ä¸­é…ç½®
```

### éƒ¨ç½²é…ç½®

**Vercel é…ç½®** (`vercel.json`):
```json
{
  "buildCommand": "npm run build",
  "outputDirectory": "dist",
  "functions": {
    "api/**/*.js": {
      "memory": 1024,
      "maxDuration": 10
    }
  }
}
```

---

## ğŸ”„ å¼€å‘å·¥ä½œæµ

### åˆ†æ”¯ç­–ç•¥
- `main` - ç”Ÿäº§ç¯å¢ƒ,ç¨³å®šç‰ˆæœ¬
- `develop` - å¼€å‘ç¯å¢ƒ,é›†æˆåˆ†æ”¯
- `feature/*` - åŠŸèƒ½åˆ†æ”¯
- `hotfix/*` - ç´§æ€¥ä¿®å¤åˆ†æ”¯

### æäº¤è§„èŒƒ
```
feat: æ–°åŠŸèƒ½
fix: Bug ä¿®å¤
docs: æ–‡æ¡£æ›´æ–°
style: ä»£ç æ ¼å¼è°ƒæ•´
refactor: é‡æ„
test: æµ‹è¯•ç›¸å…³
chore: æ„å»º/å·¥å…·ç›¸å…³
```

### Code Review æ¸…å•
- [ ] ä»£ç éµå¾ªé¡¹ç›®è§„èŒƒ
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ–‡æ¡£å·²æ›´æ–°
- [ ] æ— æ˜æ˜¾æ€§èƒ½é—®é¢˜
- [ ] å®‰å…¨æ€§æ£€æŸ¥é€šè¿‡

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### æµ‹è¯•é‡‘å­—å¡”
```
      /\
     /E2E\          <- 10%: å…³é”®ç”¨æˆ·æµç¨‹
    /------\
   /  é›†æˆ  \       <- 30%: API å’Œç»„ä»¶é›†æˆ
  /----------\
 /   å•å…ƒæµ‹è¯•  \    <- 60%: åŠŸèƒ½å’Œå·¥å…·å‡½æ•°
/--------------\
```

### å½“å‰æµ‹è¯•è¦†ç›–
- å•å…ƒæµ‹è¯•: 0% (å¾…å®æ–½)
- é›†æˆæµ‹è¯•: 0% (å¾…å®æ–½)
- E2E æµ‹è¯•: 0% (å¾…å®æ–½)

**ä¸‹ä¸€æ­¥**: åœ¨ MVP å®Œæˆåæ·»åŠ æµ‹è¯•

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### å½“å‰æ€§èƒ½ (å¼€å‘ç¯å¢ƒ)
- é¦–æ¬¡åŠ è½½: ~1.5s
- TTI (Time to Interactive): ~2.0s
- Bundle å¤§å°: ~350KB (gzipped)

### æ€§èƒ½ç›®æ ‡
- é¦–æ¬¡åŠ è½½: <2s
- TTI: <3s
- Bundle å¤§å°: <500KB
- Lighthouse åˆ†æ•°: >90

---

## ğŸ” å®‰å…¨æ€§

### å®‰å…¨æªæ–½
- âœ… ä½¿ç”¨ HTTPS
- âœ… API Key å­˜å‚¨åœ¨ç¯å¢ƒå˜é‡
- âœ… Supabase RLS ç­–ç•¥ (è®¡åˆ’ä¸­)
- â³ Content Security Policy (å¾…å®æ–½)
- â³ Rate Limiting (å¾…å®æ–½)
- â³ Input Validation (å¾…å®æ–½)

### å®‰å…¨å®¡è®¡
- æœ€åå®¡è®¡: æœªè¿›è¡Œ
- ä¸‹æ¬¡å®¡è®¡: MVP å®Œæˆå

---

## ğŸ‘¥ å›¢é˜Ÿåä½œ

### æ²Ÿé€šæ¸ é“
- é¡¹ç›®ç®¡ç†: è¿™ä¸ª CLAUDE.md æ–‡ä»¶
- ä»£ç è¯„å®¡: GitHub Pull Requests
- æŠ€æœ¯è®¨è®º: é¡¹ç›®æ–‡æ¡£å’Œä»£ç æ³¨é‡Š

### æ–‡æ¡£æ›´æ–°è§„åˆ™
1. æ¯æ¬¡é‡å¤§åŠŸèƒ½å®Œæˆåæ›´æ–°
2. æ¯æ¬¡æ¶æ„å†³ç­–åè®°å½• ADR
3. æ¯æ¬¡é‡åˆ°é‡å¤§é—®é¢˜åæ›´æ–°å·²çŸ¥é—®é¢˜
4. æ¯å¤©æ›´æ–°å¼€å‘æ—¥å¿— (å¦‚æœæœ‰è¿›å±•)

---

## ğŸ“‹ å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤
```bash
# å¼€å‘
npm run dev                # å¯åŠ¨å¼€å‘æœåŠ¡å™¨ (localhost:5173)
npm run dev:proxy          # å¯åŠ¨ N8N ä»£ç†æœåŠ¡å™¨ (localhost:3001)

# æ„å»º
npm run build              # ç”Ÿäº§æ„å»º
npm run preview            # é¢„è§ˆç”Ÿäº§æ„å»º

# éƒ¨ç½²
git push origin main       # è‡ªåŠ¨éƒ¨ç½²åˆ° Vercel

# Supabase (å¾…å®‰è£…)
npm install @supabase/supabase-js
```

### é‡è¦æ–‡ä»¶ä½ç½®
- å¼€å‘è§„åˆ’: `/mvp.md`, `/midplan.md`, `/longplan.md`
- æ•°æ®åº“ç±»å‹: `/src/lib/supabase.ts`
- è·¯ç”±é…ç½®: `/src/main.tsx`
- çŠ¶æ€ç®¡ç†: `/src/store/*.ts`
- N8N é›†æˆ: `/src/n8n/*.ts`
- ä»£ç†æœåŠ¡å™¨: `/server.js`, `/api/n8n-proxy.js`

### å¿«é€Ÿé“¾æ¥
- [å¼€å‘ç¯å¢ƒ](http://localhost:5173)
- [N8N ä»£ç†](http://localhost:3001)
- [Vercel éƒ¨ç½²](https://vercel.com/dashboard)
- [Supabase Dashboard](https://app.supabase.com) (å¾…é…ç½®)

---

## ğŸ“ å­¦ä¹ èµ„æº

### é¡¹ç›®ç›¸å…³
- [React 19 æ–‡æ¡£](https://react.dev)
- [TypeScript æ–‡æ¡£](https://www.typescriptlang.org/docs)
- [Supabase æ–‡æ¡£](https://supabase.com/docs)
- [N8N æ–‡æ¡£](https://docs.n8n.io)
- [Vite æ–‡æ¡£](https://vitejs.dev)

### æœ€ä½³å®è·µ
- [React æ€§èƒ½ä¼˜åŒ–](https://react.dev/learn/render-and-commit)
- [TypeScript ç±»å‹æœ€ä½³å®è·µ](https://www.typescriptlang.org/docs/handbook/declaration-files/do-s-and-don-ts.html)
- [Supabase RLS æŒ‡å—](https://supabase.com/docs/guides/auth/row-level-security)

---

## ğŸ’¡ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### ç«‹å³è¡ŒåŠ¨ (æœ¬å‘¨)
1. âœ… åˆ›å»ºå¼€å‘è§„åˆ’æ–‡æ¡£ (mvp.md, midplan.md, longplan.md)
2. âœ… æ›´æ–° CLAUDE.md æ–‡æ¡£
3. â³ æ‰‹åŠ¨åˆ›å»º Supabase é¡¹ç›®
4. â³ é…ç½®ç¯å¢ƒå˜é‡
5. â³ å¼€å§‹ Phase 1.1: æ•°æ®åº“è¡¨åˆ›å»º

### çŸ­æœŸç›®æ ‡ (1-2å‘¨)
- å®Œæˆ Phase 1: Supabase åˆå§‹åŒ–
- å®Œæˆ Phase 2.1: ç”¨æˆ·è®¤è¯å‰ç«¯ (localStorage)
- å¼€å§‹ Phase 2.2: Supabase Auth é›†æˆ

### ä¸­æœŸç›®æ ‡ (3-4å‘¨)
- å®Œæˆ MVP æ‰€æœ‰åŠŸèƒ½
- éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ
- æ”¶é›†ç”¨æˆ·åé¦ˆ

---

## ğŸ“ è”ç³»ä¿¡æ¯

**é¡¹ç›®è´Ÿè´£äºº**: [ä½ çš„åå­—]
**æŠ€æœ¯é¡¾é—®**: Claude (AI Assistant)
**æœ€åæ›´æ–°æ—¶é—´**: 2025-01-12

---

**æ›´æ–°æ­¤æ–‡æ¡£**:
- æ¯æ¬¡å®Œæˆé‡è¦åŠŸèƒ½å
- æ¯æ¬¡åšå‡ºæ¶æ„å†³ç­–å
- æ¯æ¬¡é‡åˆ°é‡å¤§é—®é¢˜å
- æ¯å¤©ç»“æŸæ—¶ (å¦‚æœæœ‰æ˜¾è‘—è¿›å±•)

**æç¤º**: ä½¿ç”¨ Git æŸ¥çœ‹æ­¤æ–‡ä»¶çš„å†å²è®°å½•æ¥è¿½è¸ªé¡¹ç›®æ¼”è¿›ã€‚
